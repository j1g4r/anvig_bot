services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: anvig-bot:latest
    container_name: anvig-app
    restart: unless-stopped
    ports:
      - "8000:80"
      - "8080:8080"
    environment:
      APP_ENV: production
      APP_DEBUG: "${APP_DEBUG:-false}"
      APP_KEY: "${APP_KEY}"
      DESKTOP_MODE: "true"
      DB_CONNECTION: mysql
      DB_HOST: db
      DB_PORT: 3306
      DB_DATABASE: "${DB_DATABASE}"
      DB_USERNAME: "${DB_USERNAME}"
      DB_PASSWORD: "${DB_PASSWORD}"
      REDIS_HOST: redis
      BROADCAST_CONNECTION: reverb
      QUEUE_CONNECTION: redis
      CACHE_STORE: redis
      SESSION_DRIVER: redis
      REVERB_APP_ID: "${REVERB_APP_ID}"
      REVERB_APP_KEY: "${REVERB_APP_KEY}"
      REVERB_APP_SECRET: "${REVERB_APP_SECRET}"
      REVERB_HOST: "0.0.0.0"
      REVERB_PORT: 8080
      REVERB_SCHEME: http
    depends_on:
      - db
      - redis
    networks:
      - anvig-network

  db:
    image: mysql:8.0
    container_name: anvig-db
    restart: unless-stopped
    environment:
      MYSQL_DATABASE: "${DB_DATABASE}"
      MYSQL_ROOT_PASSWORD: "${DB_PASSWORD}"
      MYSQL_PASSWORD: "${DB_PASSWORD}"
      MYSQL_USER: "${DB_USERNAME}"
    volumes:
      - anvig-db-data:/var/lib/mysql
    networks:
      - anvig-network

  redis:
    image: redis:alpine
    container_name: anvig-redis
    restart: unless-stopped
    networks:
      - anvig-network

networks:
  anvig-network:
    driver: bridge

volumes:
  anvig-db-data:
